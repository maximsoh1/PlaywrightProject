# GitHub Actions CI/CD ??? Playwright ??????

## ?? ?????

? ??????? ????????? **4 GitHub Actions workflow** ??? ?????? ?????????:

### 1. **playwright-tests.yml** - ???????? ???????? ??
???????????:
- ? ??? ?????? push ? ????? `main`, `master`, `feature/Tests`
- ? ??????? ????? ?????? "Run workflow"

**??? ??????:**
- ????????????? .NET 10 ? Playwright
- ???????? ??????
- ????????? ??? ????? ?? Chromium
- ?????????? Allure ??????
- ????????? ?????? ?? GitHub Pages
- ????????? screenshots ? videos ??? ??????? ??????

### 2. **pr-tests.yml** - ????? ??? Pull Request ??
???????????:
- ? ????????????? ??? ????????/?????????? PR

**??? ??????:**
- ????????? ????? ?? ???? ?? PR
- ????????? ?????????? ? **??????????? ? PR**
- ?????????? ?????????? passed/failed ??????
- ????????? merge ???? ????? ?????

### 3. **manual-test-run.yml** - ?????? ? ??????????? ??
???????????:
- ? ?????? ??????? ? ?????????? ??????????

**?????????:**
- ?? ????? ???????? (chromium, firefox, webkit, all)
- ?? ?????? ?????? (category, name, ? ?.?.)
- ??? Headless ????? (??/???)
- ?? ????? ???????????? (staging, production, local)

### 4. **nightly-tests.yml** - ?????? ????? ??
???????????:
- ? ?????? ???? ? 2:00 UTC (5:00 ?? ??????)
- ? ??????? ????? ?????? "Run workflow"

**??? ??????:**
- ????????? ????? ?? **???? ?????????** (Chromium, Firefox, WebKit)
- ??????? ????????? ?????? ??? ??????? ????????
- ????????? ????????? ??? ???????

## ?? ??? ????????????

### 1. ?????????????? ?????? ??? push
?????? ??????? `git push` - ????? ?????????? ?????????????!

```bash
git add .
git commit -m "Add new test"
git push origin feature/Tests
```

### 2. ?????????????? ?????? ??? Pull Request
???????? PR ?? GitHub - ????? ?????????? ? ?????????? ???????? ? ??????????? ? PR.

### 3. ?????? ?????? ??????? ??????
1. ???????? https://github.com/maximsoh1/PlaywrightProject/actions
2. ???????? workflow **"Playwright Tests"**
3. ??????? **"Run workflow"**
4. ???????? ?????
5. ??????? ??????? ?????? **"Run workflow"**

### 4. ?????? ?????? ? ???????????
1. ???????? https://github.com/maximsoh1/PlaywrightProject/actions
2. ???????? workflow **"Manual Test Run"**
3. ??????? **"Run workflow"**
4. ????????? ?????????:
   - **Browser:** ???????? ??????? ??? "all" ??? ????
   - **Test Filter:** ???????? `category=smoke` ??? ???????? ??????
   - **Headless:** true/false
   - **Environment:** staging/production/local
5. ??????? **"Run workflow"**

#### ??????? ????????:
```bash
# ????????? ?????? smoke ?????
category=smoke

# ????????? ????? ? "Shopping" ? ?????
FullyQualifiedName~Shopping

# ????????? ?????????? ????
FullyQualifiedName=VSProject.Features.ShoppingFeature.CompleteShoppingJourney

# ????????? ????? Authentication ??? Shopping
(FullyQualifiedName~Authentication)|(FullyQualifiedName~Shopping)
```

## ?? ???????? ???????????

### Allure ?????? (?????????????)
????? ????????? GitHub Pages ?????? ????? ???????? ?? ??????:
```
https://maximsoh1.github.io/PlaywrightProject/
```

### ????????? ? GitHub
1. ???????? ?????? workflow: https://github.com/maximsoh1/PlaywrightProject/actions
2. ???????? ?? ?????? ??????
3. ?????????? ???? ?? ?????? **"Artifacts"**
4. ????????:
   - `allure-results` - ?????????? ??? Allure
   - `test-screenshots` - ????????? ??????? ??????
   - `test-videos` - ????? ??????? ??????

## ?? ????????? GitHub Pages (??? Allure ???????)

1. ???????? Settings ???????????: https://github.com/maximsoh1/PlaywrightProject/settings/pages
2. ? ??????? **"Source"** ????????:
   - Branch: `gh-pages`
   - Folder: `/ (root)`
3. ??????? **"Save"**
4. ????????? 1-2 ??????
5. ???????? https://maximsoh1.github.io/PlaywrightProject/

## ?? ?????????????? ?????????

### ???????? ?????????? ?????? ??????
?????????????? `.github/workflows/nightly-tests.yml`:
```yaml
schedule:
  - cron: '0 2 * * *'  # ?????? ???? ? 2:00 UTC
  - cron: '0 14 * * *' # ?????? ???? ? 14:00 UTC
```

???????? ??? cron: https://crontab.guru/

### ???????? ??????????? ? Telegram/Slack
???????? ? ????? ?????? workflow:

```yaml
    - name: Send notification
      if: always()
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_TO }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: |
          ?? ????? ?????????
          ??????: ${{ job.status }}
          ??????: ${{ github.sha }}
          ?????: ${{ github.ref }}
```

### ?????? ?? Windows/macOS
???????? `runs-on`:
```yaml
strategy:
  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]

runs-on: ${{ matrix.os }}
```

## ?? ???????? ???????

### ????????? ??????? workflow
```bash
# ?????????? act (https://github.com/nektos/act)
act -j test
```

### ???????? ?????
```bash
gh run list
gh run view <run-id> --log
```

## ?? Troubleshooting

### ????????: .NET 10 ?? ??????
**???????:** .NET 10 ? preview, ??????? ???????????? `dotnet-quality: 'preview'`

### ????????: ???????? ?? ???????????????
**???????:** ????????? ???? ? `playwright.ps1`. ???? ?????, ???????? ??:
```bash
dotnet tool install --global Microsoft.Playwright.CLI
playwright install chromium
```

### ????????: ????? ?????? ? CI, ?? ???????? ????????
**???????:**
- ?????? ?????????? ?????? (CI ?????? headless)
- ?????????? ???????/????????????
- ???????? (CI ?????????)

**???????:** ????????? ???????? ? `.runsettings` ??? ????????:
```xml
<TestTimeout>300000</TestTimeout> <!-- 5 ????? -->
```

## ?? ?????????????? ???????

- [GitHub Actions ????????????](https://docs.github.com/en/actions)
- [Playwright CI/CD](https://playwright.dev/dotnet/docs/ci)
- [Allure Docker Service](https://github.com/fescobar/allure-docker-service)

## ?? Best Practices

1. ? ?????????? ??????? smoke ????? ?? ?????? commit
2. ? ?????? ??????? - ????? ??? ????? ???????
3. ? ??????????? ???????????? ?????? ??? ?????????
4. ? ?????????? ????????? ?????? ??? ??????? ??????
5. ? ????????? ??????????? ??? ????????? ??????
